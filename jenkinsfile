pipeline {
    agent any

    stages {
        stage('Construcción de la imagen') {
            steps {
                script {
                    // Paso a) Construcción de la imagen
                    sh 'sudo su'
                    sh 'docker build -t guillermovertz/httpd:latest .'
                }
            }
        }

        stage('Ejecución del contenedor') {
            steps {
                script {
                    // Paso b) Ejecución de un contenedor usando esa imagen
                    sh 'docker run -d --name m15-jenkins guillermovertz/httpd:latest'
                }
            }
        }

        stage('Subir la imagen a DockerHub') {
            steps {
                script {
                    // Paso c) Subir esa imagen a un repositorio de imágenes (Dockerhub u otros)
                    sh 'docker login -u guillermovertz -p Tecnica1239'
                    sh 'docker push guillermovertz/httpd:latest'
                }
            }
        }
    }
}
