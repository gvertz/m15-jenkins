pipeline {
    agent any
    environment{
        DOCKERHUB_CREDENTIALS = credentials ('dockerhub')
        RepoDockerHub = 'guillermovertz'
        NameContainer = 'm15'
    }
    stages {
        stage('Build Image') {
            steps {
                script {
                    // Paso a) Construcción de la imagen
                    docker.build 'httpd:latest'
                }
            }
        }

        stage('Run Container') {
            steps {
                script {
                    // Paso b) Ejecución de un contenedor usando esa imagen
                    docker.image('httpd:latest').run('-p 8080:8080 --name http-m15')
                }
            }
        }

        stage('Push Image') {
            steps {
                script {
                    // Paso c) Subir esa imagen a un repositorio de imágenes
                    docker.withRegistry('https://hub.docker.com/repository/docker/guillermovertz/m15/general', 'dockerhub') {
                        docker.image('httpd-m15:latest').push()
                    }
                }
            }
        }
    }

    post {
        always {
            // Limpieza: detener y eliminar el contenedor después de ejecutar el pipeline
            script {
                docker.image('httpd-m15:latest').stop()
                docker.image('httpd-m15:latest').remove()
            }
        }
    }
}
    }
}
